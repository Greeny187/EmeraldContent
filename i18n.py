from typing import Dict
from database import get_group_setting, set_group_language

# √úbersetzungs-Dictionary
TRANSLATIONS = {
    'de': {
        'CHANNEL_MENU_HEADER':   'üîß Kanal ¬´{title}¬ª verwalten ‚Äì w√§hle eine Funktion:',
        'CHANNEL_STATS_MENU':    'üìä Statistiken',
        'CHANNEL_SETTINGS_MENU': '‚öôÔ∏è Einstellungen',
        'CHANNEL_BROADCAST_MENU': 'üìù Broadcast',
        'CHANNEL_BROADCAST_PROMPT': 'üì¢ Bitte sende die Nachricht, die im Kanal ver√∂ffentlicht werden soll.',
        'CHANNEL_PINS_MENU':     'üìå Pinned',
        'CHANNEL_SWITCH':        'üîÑ Kanal wechseln',
        'CHANNEL_SETTINGS_HEADER':  '‚öôÔ∏è Einstellungen f√ºr diesen Kanal:',
        'CHANNEL_SETTINGS_TITLE':   'üìù Titel √§ndern',
        'CHANNEL_SETTINGS_DESC':    'üóíÔ∏è Beschreibung √§ndern',
        'CHANNEL_SETTINGS_TITLE_PROMPT': '‚úèÔ∏è Bitte sende den neuen Titel f√ºr den Kanal.',
        'CHANNEL_SETTINGS_DESC_PROMPT':  '‚úèÔ∏è Bitte sende die neue Beschreibung f√ºr den Kanal.',
        'CHANNEL_SETTINGS_TITLE_OK':     '‚úÖ Titel erfolgreich ge√§ndert.',
        'CHANNEL_SETTINGS_DESC_OK':      '‚úÖ Beschreibung erfolgreich ge√§ndert.',
        'BACK':                  'üîô Zur√ºck',
        'ANTISPAM':              'Linksperre',
        'WELCOME_MENU':       '‚öô Begr√º√üung verwalten:',
        'RULES_MENU':         '‚öô Regeln verwalten:',
        'FAREWELL_MENU':      '‚öô Abschieds-Nachricht verwalten:',
        'RSS_MENU':           '‚öô RSS-Feeds verwalten:',
        'WELCOME_PROMPT':     '‚ÑπÔ∏è Bitte sende das neue Begr√º√üungs-Foto + Text.',
        'RULES_PROMPT':       '‚ÑπÔ∏è Bitte sende die neuen Regeln: Foto + Text.',
        'FAREWELL_PROMPT':    '‚ÑπÔ∏è Bitte sende das neue Abschieds-Foto + Text.',
        'RSS_URL_PROMPT':     '‚û°Ô∏è Bitte sende die RSS-URL.',
        'WELCOME_NONE':       '‚ö†Ô∏è Keine Begr√º√üung gesetzt.',
        'RULES_NONE':         '‚ö†Ô∏è Keine Regeln gesetzt.',
        'FAREWELL_NONE':      '‚ö†Ô∏è Keine Abschieds-Nachricht gesetzt.',
        'RSS_LIST':           '‚ÑπÔ∏è RSS Liste',
        'SELECT_GROUP':       'üîß W√§hle eine Gruppe:',
        'NO_VISIBLE_GROUPS':  '‚ö†Ô∏è Du bist in keiner sichtbaren Gruppe.',
        'LANGUAGE_FIRST_PROMPT':'üëã Hallo! Bitte w√§hle zuerst deine Sprache:',
        'MOOD_PROMPT':        '‚ÑπÔ∏è Bitte gib die neue Frage ein.',
        'STATS_ENABLED':      '‚úÖ Tagesstatistik aktiviert.',
        'STATS_DISABLED':     '‚úÖ Tagesstatistik deaktiviert.',
        'LANGUAGE_SET':       '‚úÖ Sprache gespeichert: {lang}',
        'LANGUAGE_CURRENT':   'Aktuelle Sprache: {lang}',
        'ERROR_PRIV_CMD':    '‚ö†Ô∏è Nur in Gruppen nutzbar.',
        'ERROR_ADMIN_CMD':   '‚ùå Nur Admins d√ºrfen das tun.',
        'ERROR_USAGE_LANG':  'Verwendung: /setlanguage de|en|fr|ru',
        'MENU_WELCOME':       'Begr√º√üung',
        'MENU_RULES':         'Regeln',
        'MENU_FAREWELL':      'Abschied',
        'MENU_RSS':           'RSS',
        'MENU_STATS':         'Statistiken',
        'MENU_MOOD':          'Frage √§ndern',
        'MENU_LANGUAGE':      'Sprache',
        'MENU_CLEANUP':       'Cleanup',
        'MENU_HELP':          'Hilfe',
        'MENU_GROUP_SELECT':  'Gruppe w√§hlen',
        'MENU_HEADER':        'üîß Gruppe verwalten ‚Äì w√§hle eine Funktion:',
        'ANTISPAM':            'Linksperre',
        'RSS_NONE':            '‚ö†Ô∏è Keine RSS-Feeds gesetzt.',
        'CLEANUP_DONE':        '‚úÖ Gel√∂schte Accounts entfernt: {count}',
        'LANG_SELECT_PROMPT':  'üëã Bitte w√§hle deine Sprache:',
    },
    'en': {
        'CHANNEL_MENU_HEADER':   'üîß Manage channel ¬´{title}¬ª ‚Äì pick an option:',
        'CHANNEL_STATS_MENU':    'üìä Stats',
        'CHANNEL_SETTINGS_MENU': '‚öôÔ∏è Settings',
        'CHANNEL_BROADCAST_MENU': 'üìù Broadcast',
        'CHANNEL_PINS_MENU':     'üìå Pinned',
        'CHANNEL_SWITCH':        'üîÑ Switch channel',
        'CHANNEL_SETTINGS_HEADER':  '‚öôÔ∏è Channel Settings:',
        'CHANNEL_SETTINGS_TITLE':   'üìù Edit title',
        'CHANNEL_SETTINGS_DESC':    'üóíÔ∏è Edit description',
        'CHANNEL_SETTINGS_TITLE_PROMPT': '‚úèÔ∏è Please send the new title for the channel.',
        'CHANNEL_SETTINGS_DESC_PROMPT':  '‚úèÔ∏è Please send the new description for the channel.',
        'CHANNEL_SETTINGS_TITLE_OK':     '‚úÖ Title updated successfully.',
        'CHANNEL_SETTINGS_DESC_OK':      '‚úÖ Description updated successfully.',
        'BACK':                  'üîô Back',
        'MENU_WELCOME':         'Welcome message',
        'MENU_RULES':           'Rules',
        'MENU_FAREWELL':        'Farewell message',
        'MENU_RSS':             'RSS',
        'MENU_STATS':           'Stats',
        'MENU_MOOD':            'Edit question',
        'MENU_LANGUAGE':        'Language',
        'MENU_CLEANUP':         'Cleanup',
        'MENU_HELP':            'Help',
        'MENU_GROUP_SELECT':    'Select group',
        'MENU_HEADER':          'üîß Manage group ‚Äì pick an option:',
        'WELCOME_MENU':         '‚öô Manage welcome message:',
        'RULES_MENU':           '‚öô Manage rules:',
        'FAREWELL_MENU':        '‚öô Manage farewell message:',
        'RSS_MENU':             '‚öô Manage RSS feeds:',
        'WELCOME_PROMPT':       '‚ÑπÔ∏è Please send the new welcome photo + text.',
        'RULES_PROMPT':         '‚ÑπÔ∏è Please send the new rules photo + text.',
        'FAREWELL_PROMPT':      '‚ÑπÔ∏è Please send the new farewell photo + text.',
        'RSS_URL_PROMPT':       '‚û°Ô∏è Please send the RSS URL.',
        'WELCOME_NONE':         '‚ö†Ô∏è No welcome message set.',
        'RULES_NONE':           '‚ö†Ô∏è No rules set.',
        'FAREWELL_NONE':        '‚ö†Ô∏è No farewell message set.',
        'RSS_NONE':             '‚ö†Ô∏è No RSS feeds set.',
        'SELECT_GROUP':         'üîß Select a group:',
        'NO_VISIBLE_GROUPS':    '‚ö†Ô∏è You are not an admin of any group where the bot is active.',
        'LANGUAGE_FIRST_PROMPT':'üëã Hi there! Please select your language first:',
        'MOOD_PROMPT':          '‚ÑπÔ∏è Please enter the new question.',
        'STATS_ENABLED':        '‚úÖ Daily stats enabled.',
        'STATS_DISABLED':       '‚úÖ Daily stats disabled.',
        'LANGUAGE_SET':         '‚úÖ Language set to: {lang}',
        'LANGUAGE_CURRENT':     'Current language is: {lang}',
        'ANTISPAM':            'Link lock',
        'RSS_LIST':            '‚ÑπÔ∏è RSS list',
        'CLEANUP_DONE':        '‚úÖ Deleted accounts removed: {count}',
        'LANG_SELECT_PROMPT':  'üëã Please select a language:',
    },
    'fr': {
        'CHANNEL_MENU_HEADER':   'üîß G√©rer le canal ¬´{title}¬ª ‚Äì choisissez une option :',
        'CHANNEL_STATS_MENU':    'üìä Statistiques',
        'CHANNEL_SETTINGS_MENU': '‚öôÔ∏è Param√®tres',
        'CHANNEL_BROADCAST_MENU': 'üìù Diffusion',
        'CHANNEL_PINS_MENU':     'üìå √âpingl√©s',
        'CHANNEL_SWITCH':        'üîÑ Changer de canal',
        'CHANNEL_SETTINGS_HEADER':  '‚öôÔ∏è Param√®tres du canal :',
        'CHANNEL_SETTINGS_TITLE':   'üìù Modifier le titre',
        'CHANNEL_SETTINGS_DESC':    'üóíÔ∏è Modifier la description',
        'CHANNEL_SETTINGS_TITLE_PROMPT': '‚úèÔ∏è Veuillez envoyer le nouveau titre du canal.',
        'CHANNEL_SETTINGS_DESC_PROMPT':  '‚úèÔ∏è Veuillez envoyer la nouvelle description du canal.',
        'CHANNEL_SETTINGS_TITLE_OK':     '‚úÖ Titre modifi√© avec succ√®s.',
        'CHANNEL_SETTINGS_DESC_OK':      '‚úÖ Description modifi√©e avec succ√®s.',
        'BACK':                  'üîô Retour',
        'MENU_WELCOME':         'Message de bienvenue',
        'MENU_RULES':           'R√®gles',
        'MENU_FAREWELL':        'Message d‚Äôau revoir',
        'MENU_RSS':             'RSS',
        'MENU_STATS':           'Statistiques',
        'MENU_MOOD':            'Modifier la question',
        'MENU_LANGUAGE':        'Langue',
        'MENU_CLEANUP':         'Nettoyage',
        'MENU_HELP':            'Aide',
        'MENU_GROUP_SELECT':    'Choisir un groupe',
        'MENU_HEADER':          'üîß G√©rer le groupe ‚Äì choisissez une option :',
        'WELCOME_MENU':         '‚öô G√©rer le message de bienvenue :',
        'RULES_MENU':           '‚öô G√©rer les r√®gles :',
        'FAREWELL_MENU':        '‚öô G√©rer le message d‚Äôau revoir :',
        'RSS_MENU':             '‚öô G√©rer les flux RSS :',
        'WELCOME_PROMPT':       '‚ÑπÔ∏è Veuillez envoyer la nouvelle photo + texte de bienvenue.',
        'RULES_PROMPT':         '‚ÑπÔ∏è Veuillez envoyer la nouvelle photo + texte des r√®gles.',
        'FAREWELL_PROMPT':      '‚ÑπÔ∏è Veuillez envoyer la nouvelle photo + texte d‚Äôau revoir.',
        'RSS_URL_PROMPT':       '‚û°Ô∏è Veuillez envoyer l‚ÄôURL du flux RSS.',
        'WELCOME_NONE':         '‚ö†Ô∏è Aucun message de bienvenue d√©fini.',
        'RULES_NONE':           '‚ö†Ô∏è Aucune r√®gle d√©finie.',
        'FAREWELL_NONE':        '‚ö†Ô∏è Aucun message d‚Äôau revoir d√©fini.',
        'RSS_NONE':             '‚ö†Ô∏è Aucun flux RSS d√©fini.',
        'SELECT_GROUP':         'üîß Choisissez un groupe :',
        'NO_VISIBLE_GROUPS':    '‚ö†Ô∏è Vous n‚Äô√™tes administrateur d‚Äôaucun groupe actif.',
        'LANGUAGE_FIRST_PROMPT':'üëã Bonjour ! Veuillez d‚Äôabord choisir votre langue :',
        'MOOD_PROMPT':          '‚ÑπÔ∏è Veuillez entrer la nouvelle question.',
        'STATS_ENABLED':        '‚úÖ Statistiques journali√®res activ√©es.',
        'STATS_DISABLED':       '‚úÖ Statistiques journali√®res d√©sactiv√©es.',
        'LANGUAGE_SET':         '‚úÖ Langue d√©finie sur : {lang}',
        'LANGUAGE_CURRENT':     'La langue actuelle est : {lang}',
        'ANTISPAM':            'Blocage des liens',
        'RSS_LIST':            '‚ÑπÔ∏è Liste RSS',
        'RSS_NONE':            '‚ö†Ô∏è Aucun flux RSS d√©fini.',
        'CLEANUP_DONE':        '‚úÖ Comptes supprim√©s retir√©s : {count}',
        'LANG_SELECT_PROMPT':  'üëã Veuillez s√©lectionner une langue :',
    },
    'ru': {
        'CHANNEL_SETTINGS_HEADER':  '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞:',
        'CHANNEL_SETTINGS_TITLE':   'üìù –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ',
        'CHANNEL_SETTINGS_DESC':    'üóíÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ',
        'CHANNEL_SETTINGS_TITLE_PROMPT': '‚úèÔ∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞.',
        'CHANNEL_SETTINGS_DESC_PROMPT':  '‚úèÔ∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞.',
        'CHANNEL_SETTINGS_TITLE_OK':     '‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–æ.',
        'CHANNEL_SETTINGS_DESC_OK':      '‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–æ.',
        'MENU_WELCOME':         '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',
        'MENU_RULES':           '–ü—Ä–∞–≤–∏–ª–∞',
        'MENU_FAREWELL':        '–°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—â–∞–Ω–∏—è',
        'MENU_RSS':             'RSS',
        'MENU_STATS':           '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
        'MENU_MOOD':            '–ò–∑–º–µ–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å',
        'MENU_LANGUAGE':        '–Ø–∑—ã–∫',
        'MENU_CLEANUP':         '–û—á–∏—Å—Ç–∫–∞',
        'MENU_HELP':            '–ü–æ–º–æ—â—å',
        'MENU_GROUP_SELECT':    '–í—ã–±—Ä–∞—Ç—å –≥—Ä—É–ø–ø—É',
        'MENU_HEADER':          'üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–π ‚Äì –≤—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:',
        'WELCOME_MENU':         '‚öô –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º:',
        'RULES_MENU':           '‚öô –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º–∏:',
        'FAREWELL_MENU':        '‚öô –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ø—Ä–æ—â–∞–Ω–∏—è:',
        'RSS_MENU':             '‚öô –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ RSS-–∫–∞–Ω–∞–ª–∞–º–∏:',
        'WELCOME_PROMPT':       '‚ÑπÔ∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ + —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è.',
        'RULES_PROMPT':         '‚ÑπÔ∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ + —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–∞–≤–∏–ª.',
        'FAREWELL_PROMPT':      '‚ÑπÔ∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ + —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–æ—â–∞–Ω–∏—è.',
        'RSS_URL_PROMPT':       '‚û°Ô∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ URL RSS-–ª–µ–Ω—Ç—ã.',
        'WELCOME_NONE':         '‚ö†Ô∏è –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –∑–∞–¥–∞–Ω–æ.',
        'RULES_NONE':           '‚ö†Ô∏è –ü—Ä–∞–≤–∏–ª–∞ –Ω–µ –∑–∞–¥–∞–Ω—ã.',
        'FAREWELL_NONE':        '‚ö†Ô∏è –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—â–∞–Ω–∏—è –Ω–µ –∑–∞–¥–∞–Ω–æ.',
        'RSS_NONE':             '‚ö†Ô∏è RSS-–ª–µ–Ω—Ç—ã –Ω–µ –∑–∞–¥–∞–Ω—ã.',
        'SELECT_GROUP':         'üîß –í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É:',
        'NO_VISIBLE_GROUPS':    '‚ö†Ô∏è –í—ã –Ω–µ —è–≤–ª—è–µ—Ç–µ—Å—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –Ω–∏ –æ–¥–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –≥—Ä—É–ø–ø—ã.',
        'LANGUAGE_FIRST_PROMPT':'üëã –ü—Ä–∏–≤–µ—Ç! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫:',
        'MOOD_PROMPT':          '‚ÑπÔ∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å.',
        'STATS_ENABLED':        '‚úÖ –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞.',
        'STATS_DISABLED':       '‚úÖ –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞.',
        'LANGUAGE_SET':         '‚úÖ –Ø–∑—ã–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: {lang}',
        'LANGUAGE_CURRENT':     '–¢–µ–∫—É—â–∏–π —è–∑—ã–∫: {lang}',
        'ANTISPAM':            '–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Å—ã–ª–æ–∫',
        'RSS_LIST':            '‚ÑπÔ∏è –°–ø–∏—Å–æ–∫ RSS',
        'CLEANUP_DONE':        '‚úÖ –£–¥–∞–ª—ë–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã —É–¥–∞–ª–µ–Ω—ã: {count}',
        'LANG_SELECT_PROMPT':  'üëã –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫:',
    },
}

def t(chat_id: int, key: str) -> str:
    """
    √úbersetzung anhand der in der Datenbank gespeicherten Sprache des Chats.
    """
    setting = get_group_setting(chat_id)
    lang = setting.language if setting and setting.language in TRANSLATIONS else 'de'
    return TRANSLATIONS[lang].get(key, TRANSLATIONS['de'].get(key, key))


def set_language_callback(update, context):
    from telegram.ext import CallbackContext
    query = update.callback_query
    chat_id = query.message.chat.id
    _, lang = query.data.split('_', 1)
    set_group_language(chat_id, lang)
    query.answer()
    query.edit_message_text(text=t(chat_id, 'LANGUAGE_SET'))