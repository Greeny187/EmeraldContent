from typing import Dict
from database import get_group_setting, set_group_language

# Ãœbersetzungs-Dictionary
TRANSLATIONS = {
    'de': {
        'CHANNEL_MENU_HEADER':   'ðŸ”§ Kanal Â«{title}Â» verwalten â€“ wÃ¤hle eine Funktion:',
        'CHANNEL_STATS_MENU':    'ðŸ“Š Statistiken',
        'CHANNEL_SETTINGS_MENU': 'âš™ï¸ Einstellungen',
        'CHANNEL_BROADCAST_MENU': 'ðŸ“ Broadcast',
        'CHANNEL_PINS_MENU':     'ðŸ“Œ Pinned',
        'CHANNEL_SWITCH':        'ðŸ”„ Kanal wechseln',
        'BACK':                  'ðŸ”™ ZurÃ¼ck',
        'WELCOME_MENU':       'âš™ BegrÃ¼ÃŸung verwalten:',
        'RULES_MENU':         'âš™ Regeln verwalten:',
        'FAREWELL_MENU':      'âš™ Abschieds-Nachricht verwalten:',
        'RSS_MENU':           'âš™ RSS-Feeds verwalten:',
        'WELCOME_PROMPT':     'â„¹ï¸ Bitte sende das neue BegrÃ¼ÃŸungs-Foto + Text.',
        'RULES_PROMPT':       'â„¹ï¸ Bitte sende das neue Regeln-Foto + Text.',
        'FAREWELL_PROMPT':    'â„¹ï¸ Bitte sende das neue Abschieds-Foto + Text.',
        'RSS_URL_PROMPT':     'âž¡ï¸ Bitte sende die RSS-URL.',
        'WELCOME_NONE':       'âš ï¸ Keine BegrÃ¼ÃŸung gesetzt.',
        'RULES_NONE':         'âš ï¸ Keine Regeln gesetzt.',
        'FAREWELL_NONE':      'âš ï¸ Keine Abschieds-Nachricht gesetzt.',
        'RSS_NONE':           'âš ï¸ Keine RSS-Feeds gesetzt.',
        'SELECT_GROUP':       'ðŸ”§ WÃ¤hle eine Gruppe:',
        'NO_VISIBLE_GROUPS':  'âš ï¸ Du bist in keiner sichtbaren Gruppe.',
        'LANGUAGE_FIRST_PROMPT':'ðŸ‘‹ Hallo! Bitte wÃ¤hle zuerst deine Sprache:',
        'MOOD_PROMPT':        'â„¹ï¸ Bitte gib die neue Frage ein.',
        'STATS_ENABLED':      'âœ… Tagesstatistik aktiviert.',
        'STATS_DISABLED':     'âœ… Tagesstatistik deaktiviert.',
        'LANGUAGE_SET':       'âœ… Sprache gespeichert: {lang}',
        'LANGUAGE_CURRENT':   'Aktuelle Sprache: {lang}',
        'ERROR_PRIV_CMD':    'âš ï¸ Nur in Gruppen nutzbar.',
        'ERROR_ADMIN_CMD':   'âŒ Nur Admins dÃ¼rfen das tun.',
        'ERROR_USAGE_LANG':  'Verwendung: /setlanguage de|en|fr|ru',
        'MENU_WELCOME':       'BegrÃ¼ÃŸung',
        'MENU_RULES':         'Regeln',
        'MENU_FAREWELL':      'Abschied',
        'MENU_RSS':           'RSS',
        'MENU_STATS':         'Statistiken',
        'MENU_MOOD':          'Frage Ã¤ndern',
        'MENU_LANGUAGE':      'Sprache',
        'MENU_CLEANUP':       'Cleanup',
        'MENU_HELP':          'Hilfe',
        'MENU_GROUP_SELECT':  'Gruppe wÃ¤hlen',
        'MENU_HEADER':        'ðŸ”§ Gruppe verwalten â€“ wÃ¤hle eine Funktion:',
    },
    'en': {
        'CHANNEL_MENU_HEADER':   'ðŸ”§ Manage channel Â«{title}Â» â€“ pick an option:',
        'CHANNEL_STATS_MENU':    'ðŸ“Š Stats',
        'CHANNEL_SETTINGS_MENU': 'âš™ï¸ Settings',
        'CHANNEL_BROADCAST_MENU': 'ðŸ“ Broadcast',
        'CHANNEL_PINS_MENU':     'ðŸ“Œ Pinned',
        'CHANNEL_SWITCH':        'ðŸ”„ Switch channel',
        'BACK':                  'ðŸ”™ Back',
        'MENU_WELCOME':         'Welcome message',
        'MENU_RULES':           'Rules',
        'MENU_FAREWELL':        'Farewell message',
        'MENU_RSS':             'RSS',
        'MENU_STATS':           'Stats',
        'MENU_MOOD':            'Edit question',
        'MENU_LANGUAGE':        'Language',
        'MENU_CLEANUP':         'Cleanup',
        'MENU_HELP':            'Help',
        'MENU_GROUP_SELECT':    'Select group',
        'MENU_HEADER':          'ðŸ”§ Manage group â€“ pick an option:',
        'WELCOME_MENU':         'âš™ Manage welcome message:',
        'RULES_MENU':           'âš™ Manage rules:',
        'FAREWELL_MENU':        'âš™ Manage farewell message:',
        'RSS_MENU':             'âš™ Manage RSS feeds:',
        'WELCOME_PROMPT':       'â„¹ï¸ Please send the new welcome photo + text.',
        'RULES_PROMPT':         'â„¹ï¸ Please send the new rules photo + text.',
        'FAREWELL_PROMPT':      'â„¹ï¸ Please send the new farewell photo + text.',
        'RSS_URL_PROMPT':       'âž¡ï¸ Please send the RSS URL.',
        'WELCOME_NONE':         'âš ï¸ No welcome message set.',
        'RULES_NONE':           'âš ï¸ No rules set.',
        'FAREWELL_NONE':        'âš ï¸ No farewell message set.',
        'RSS_NONE':             'âš ï¸ No RSS feeds set.',
        'SELECT_GROUP':         'ðŸ”§ Select a group:',
        'NO_VISIBLE_GROUPS':    'âš ï¸ You are not an admin of any group where the bot is active.',
        'LANGUAGE_FIRST_PROMPT':'ðŸ‘‹ Hi there! Please select your language first:',
        'MOOD_PROMPT':          'â„¹ï¸ Please enter the new question.',
        'STATS_ENABLED':        'âœ… Daily stats enabled.',
        'STATS_DISABLED':       'âœ… Daily stats disabled.',
        'LANGUAGE_SET':         'âœ… Language set to: {lang}',
        'LANGUAGE_CURRENT':     'Current language is: {lang}',
    },
    'fr': {
        'CHANNEL_MENU_HEADER':   'ðŸ”§ GÃ©rer le canal Â«{title}Â» â€“ choisissez une option :',
        'CHANNEL_STATS_MENU':    'ðŸ“Š Statistiques',
        'CHANNEL_SETTINGS_MENU': 'âš™ï¸ ParamÃ¨tres',
        'CHANNEL_BROADCAST_MENU': 'ðŸ“ Diffusion',
        'CHANNEL_PINS_MENU':     'ðŸ“Œ Ã‰pinglÃ©s',
        'CHANNEL_SWITCH':        'ðŸ”„ Changer de canal',
        'BACK':                  'ðŸ”™ Retour',
        'MENU_WELCOME':         'Message de bienvenue',
        'MENU_RULES':           'RÃ¨gles',
        'MENU_FAREWELL':        'Message dâ€™au revoir',
        'MENU_RSS':             'RSS',
        'MENU_STATS':           'Statistiques',
        'MENU_MOOD':            'Modifier la question',
        'MENU_LANGUAGE':        'Langue',
        'MENU_CLEANUP':         'Nettoyage',
        'MENU_HELP':            'Aide',
        'MENU_GROUP_SELECT':    'Choisir un groupe',
        'MENU_HEADER':          'ðŸ”§ GÃ©rer le groupe â€“ choisissez une option :',
        'WELCOME_MENU':         'âš™ GÃ©rer le message de bienvenue :',
        'RULES_MENU':           'âš™ GÃ©rer les rÃ¨gles :',
        'FAREWELL_MENU':        'âš™ GÃ©rer le message dâ€™au revoir :',
        'RSS_MENU':             'âš™ GÃ©rer les flux RSS :',
        'WELCOME_PROMPT':       'â„¹ï¸ Veuillez envoyer la nouvelle photo + texte de bienvenue.',
        'RULES_PROMPT':         'â„¹ï¸ Veuillez envoyer la nouvelle photo + texte des rÃ¨gles.',
        'FAREWELL_PROMPT':      'â„¹ï¸ Veuillez envoyer la nouvelle photo + texte dâ€™au revoir.',
        'RSS_URL_PROMPT':       'âž¡ï¸ Veuillez envoyer lâ€™URL du flux RSS.',
        'WELCOME_NONE':         'âš ï¸ Aucun message de bienvenue dÃ©fini.',
        'RULES_NONE':           'âš ï¸ Aucune rÃ¨gle dÃ©finie.',
        'FAREWELL_NONE':        'âš ï¸ Aucun message dâ€™au revoir dÃ©fini.',
        'RSS_NONE':             'âš ï¸ Aucun flux RSS dÃ©fini.',
        'SELECT_GROUP':         'ðŸ”§ Choisissez un groupe :',
        'NO_VISIBLE_GROUPS':    'âš ï¸ Vous nâ€™Ãªtes administrateur dâ€™aucun groupe actif.',
        'LANGUAGE_FIRST_PROMPT':'ðŸ‘‹ Bonjour ! Veuillez dâ€™abord choisir votre langue :',
        'MOOD_PROMPT':          'â„¹ï¸ Veuillez entrer la nouvelle question.',
        'STATS_ENABLED':        'âœ… Statistiques journaliÃ¨res activÃ©es.',
        'STATS_DISABLED':       'âœ… Statistiques journaliÃ¨res dÃ©sactivÃ©es.',
        'LANGUAGE_SET':         'âœ… Langue dÃ©finie sur : {lang}',
        'LANGUAGE_CURRENT':     'La langue actuelle est : {lang}',
    },
    'ru': {
        'MENU_WELCOME':         'ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ',
        'MENU_RULES':           'ÐŸÑ€Ð°Ð²Ð¸Ð»Ð°',
        'MENU_FAREWELL':        'Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ñ‰Ð°Ð½Ð¸Ñ',
        'MENU_RSS':             'RSS',
        'MENU_STATS':           'Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°',
        'MENU_MOOD':            'Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾Ñ',
        'MENU_LANGUAGE':        'Ð¯Ð·Ñ‹Ðº',
        'MENU_CLEANUP':         'ÐžÑ‡Ð¸ÑÑ‚ÐºÐ°',
        'MENU_HELP':            'ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ',
        'MENU_GROUP_SELECT':    'Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð³Ñ€ÑƒÐ¿Ð¿Ñƒ',
        'MENU_HEADER':          'ðŸ”§ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð³Ñ€ÑƒÐ¿Ð¿Ð¾Ð¹ â€“ Ð²Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ:',
        'WELCOME_MENU':         'âš™ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÐµÐ¼:',
        'RULES_MENU':           'âš™ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°Ð¼Ð¸:',
        'FAREWELL_MENU':        'âš™ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÐµÐ¼ Ð¿Ñ€Ð¾Ñ‰Ð°Ð½Ð¸Ñ:',
        'RSS_MENU':             'âš™ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ RSS-ÐºÐ°Ð½Ð°Ð»Ð°Ð¼Ð¸:',
        'WELCOME_PROMPT':       'â„¹ï¸ ÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ð½Ð¾Ð²Ð¾Ðµ Ñ„Ð¾Ñ‚Ð¾ + Ñ‚ÐµÐºÑÑ‚ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ñ.',
        'RULES_PROMPT':         'â„¹ï¸ ÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ð½Ð¾Ð²Ð¾Ðµ Ñ„Ð¾Ñ‚Ð¾ + Ñ‚ÐµÐºÑÑ‚ Ð´Ð»Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð».',
        'FAREWELL_PROMPT':      'â„¹ï¸ ÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ð½Ð¾Ð²Ð¾Ðµ Ñ„Ð¾Ñ‚Ð¾ + Ñ‚ÐµÐºÑÑ‚ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ñ‰Ð°Ð½Ð¸Ñ.',
        'RSS_URL_PROMPT':       'âž¡ï¸ ÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ URL RSS-Ð»ÐµÐ½Ñ‚Ñ‹.',
        'WELCOME_NONE':         'âš ï¸ ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð½Ðµ Ð·Ð°Ð´Ð°Ð½Ð¾.',
        'RULES_NONE':           'âš ï¸ ÐŸÑ€Ð°Ð²Ð¸Ð»Ð° Ð½Ðµ Ð·Ð°Ð´Ð°Ð½Ñ‹.',
        'FAREWELL_NONE':        'âš ï¸ Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ñ‰Ð°Ð½Ð¸Ñ Ð½Ðµ Ð·Ð°Ð´Ð°Ð½Ð¾.',
        'RSS_NONE':             'âš ï¸ RSS-Ð»ÐµÐ½Ñ‚Ñ‹ Ð½Ðµ Ð·Ð°Ð´Ð°Ð½Ñ‹.',
        'SELECT_GROUP':         'ðŸ”§ Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð³Ñ€ÑƒÐ¿Ð¿Ñƒ:',
        'NO_VISIBLE_GROUPS':    'âš ï¸ Ð’Ñ‹ Ð½Ðµ ÑÐ²Ð»ÑÐµÑ‚ÐµÑÑŒ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð¼ Ð½Ð¸ Ð¾Ð´Ð½Ð¾Ð¹ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾Ð¹ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹.',
        'LANGUAGE_FIRST_PROMPT':'ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚! ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑÐ½Ð°Ñ‡Ð°Ð»Ð° Ð²Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ·Ñ‹Ðº:',
        'MOOD_PROMPT':          'â„¹ï¸ ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ.',
        'STATS_ENABLED':        'âœ… Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ð°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð°.',
        'STATS_DISABLED':       'âœ… Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ð°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð°.',
        'LANGUAGE_SET':         'âœ… Ð¯Ð·Ñ‹Ðº ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½: {lang}',
        'LANGUAGE_CURRENT':     'Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ ÑÐ·Ñ‹Ðº: {lang}',
    },
}

def t(chat_id: int, key: str) -> str:
    """
    Ãœbersetzung anhand der in der Datenbank gespeicherten Sprache des Chats.
    """
    setting = get_group_setting(chat_id)
    lang = setting.language if setting and setting.language in TRANSLATIONS else 'de'
    return TRANSLATIONS[lang].get(key, TRANSLATIONS['de'].get(key, key))


def set_language_callback(update, context):
    from telegram.ext import CallbackContext
    query = update.callback_query
    chat_id = query.message.chat.id
    _, lang = query.data.split('_', 1)
    set_group_language(chat_id, lang)
    query.answer()
    query.edit_message_text(text=t(chat_id, 'LANGUAGE_SET'))